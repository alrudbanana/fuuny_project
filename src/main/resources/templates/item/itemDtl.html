<!DOCTYPE html>
<html lang="ko"
	xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}"
>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
<th:block layout:fragment="css">

 <!--
    <meta name="_csrf" th:content="${_csrf.token}"/>
    
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
 -->

<!-- 사용자 스크립트 추가 -->
<th:block layout:fragment="script">
    <script th:inline="javascript">
        $(document).ready(function(){

            calculateToalPrice();

            $("#count").change( function(){
                calculateToalPrice();
            });
        });

        function calculateToalPrice(){
            var count = $("#count").val();
            var price = $("#price").val();
            var totalPrice = price*count;
            $("#totalPrice").html(totalPrice + '원');
        }

        function order(){
        	
            var token = $("meta[name='_csrf']").attr("content");
            var header = $("meta[name='_csrf_header']").attr("content");

           
            var url = "/order";
            var paramData = {
                itemId : $("#itemId").val(),
                count : $("#count").val()
            };

            var param = JSON.stringify(paramData);

            $.ajax({
                url      : url,
                type     : "POST",
                contentType : "application/json",
                data     : param,
                beforeSend : function(xhr){
                    /* 데이터를 전송하기 전에 헤더에 csrf값을 설정 */
                    xhr.setRequestHeader(header, token);
                },
                dataType : "json",
                cache   : false,
                success  : function(result, status){
                    alert("주문이 완료 되었습니다.");
                    location.href='/';
                },
                error : function(jqXHR, status, error){

                    if(jqXHR.status == '401'){
                        alert('로그인 후 이용해주세요');
                        location.href='/members/login';
                    } else{
                        alert(jqXHR.responseText);
                    }

                }
            });
        }

        function addCart(){
            var token = $("meta[name='_csrf']").attr("content");
            var header = $("meta[name='_csrf_header']").attr("content");

            var url = "/cart";
            var paramData = {
                itemId : $("#itemId").val(),
                count : $("#count").val()
            };

            var param = JSON.stringify(paramData);

            $.ajax({
                url      : url,
                type     : "POST",
                contentType : "application/json",
                data     : param,
                beforeSend : function(xhr){
                    /* 데이터를 전송하기 전에 헤더에 csrf값을 설정 */
                    xhr.setRequestHeader(header, token);
                },
                dataType : "json",
                cache   : false,
                success  : function(result, status){
                    alert("상품을 장바구니에 담았습니다.");
                    location.href='/';
                },
                error : function(jqXHR, status, error){

                    if(jqXHR.status == '401'){
                        alert('로그인 후 이용해주세요');
                        location.href='/members/login';
                    } else{
                        alert(jqXHR.responseText);
                    }

                }
            });
        }

    </script>
</th:block>
  

  
  
  <style>
  
    *{
            
            margin: 0;
            padding: 0;
            font-family: 'NanumSquareNeo-Variable';
            
        }
       li {
        list-style: none;
       }
    
      
        .main {
            height: 800px;
            /* border: 1px solid red; */
            text-align: center;
            position: re;
        }
        #btn_category{
            margin: 40px 0 20px 0;
            padding: 3px;
        }
       #main_image{
        border: 1px solid ;
        width: 500px;
        height: 300px;
        position: absolute;
        left: 10%;
         
       }
       #product {
        /* border: 1px solid blue; */
        width: 400px;
        right: 20%;
        position: absolute;
       }

       #product button{
        display: flex;     
        margin: 20px auto;
        
       }
       h1{
        margin-bottom: 40px;
       }
   
       .main_list li {
        text-align: left;
        padding: 3px;
       
       }
       .text_1 {
        font-size: 14px;
       
        
       }
       .text_2 {
        font-weight: bold;
        margin-bottom: 15px;
        font-size: 20px;
       }
       .main_line{
        margin: 30px 0;
        border-bottom: 1px solid rgb(223, 221, 221);
       }

       .tb_price{
        text-align: left;
        font-size: 13px;
       }
       .tb_price td{
        padding: 5px 0 5px 15px;        
       }
       .td_1{
        font-weight: bold;
       }
       .td_2{
        margin-left: 10px;
        font-size: 12px;
       }
       .btn_good{
        margin-top: 20px;
        
       }
       .btn_good img{
        width: 20px;
       
        
       }
       .pro_detail{
       	font-weight: bold;
       }
	


       



       /* 푸터 */
       
        
             @font-face {
	font-family: 'NanumSquareNeo-Variable';
	src:
		url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_11-01@1.0/NanumSquareNeo-Variable.woff2')
		format('woff2');
	font-weight: normal;
	font-style: normal;
}






  </style>
</th:block>
<div layout:fragment="content">
    <div class="rap">

        <!--헤더시작-->
      <header><div data-include="header.html"></div></header>
        <!--헤더 끝-->

        <!--메인시작-->
        <section>
            <div class="main">
            	<button th:text="${item.itemCategory}" type=submit id="btn_category"></button>               
                <h1 th:text="${item.itemNm}" >제목입니다.</h1>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

    <!-- 상단 이미지 / 상세정보 박스 -->
<div class="container text-center">
    <div class="row">
      <div class="col-lg-8">
        <img th:src="${item.itemImgDtoList[0].imgUrl}" th:alt="${item.itemNm}">
      </div>
      <div class="col-lg-4">
        <ul class="main_list">
            <li class="text_1">모인금액</li>
            <li class="text_2">원</li>
            <li class="text_1" th:text="${item.remainingDays}">남은시간</li>
            <li class="text_2">일</li>
        </ul>
        <div class="main_line"></div>
        <table class="tb_price">
            <tr>
            <td class="td_1" th:text="${item.Price}">상품금액</td>
            <td class="td_2">원</td>
            </tr>
            <tr>
                <td class="td_1">펀딩 기간</td>
                <td class="td_2"><span th:text="${item.startDate}"></span> ~ <span th:text="${item.endDate}"></span></td>
            </tr>
            <tr>
                <td class="td_1">결제</td>
                <td class="td_2">목표금액 달성시 <span th:text="${item.endDate}"></span>에 결제 진행</td>
            </tr>
        </table>
        <div class="btn_good">
            <a href = "/cart"><button type="submit" class="btn btn-danger" onclick="cart()">이 프로젝트 후원하기</button></a>
        </div>
       

      </div>
      
    </div>
    
  </div>
 
  <div class="main_line"></div>
  <p class="pro_detail">--- 상품 상세 설명 ---</p>
   <p th:text="${item.itemDetail}">설명</p>

	<div th:each="itemImg : ${item.itemImgDtoList}" class="text-center">
        <img th:if="${not #strings.isEmpty(itemImg.imgUrl)}" th:src="${itemImg.imgUrl}" class="rounded mgb-15" width="800">

</div>




  
  
</div>
</section>
<!--메인 끝-->



    <!--푸터시작-->
        <footer>
           <div data-include="footer.html"></div>
           
        </div>
        </footer>
        <!--푸터 끝-->
    </div>
    <script src="./js/header.js"></script>
    
</div>

</html>





</html>